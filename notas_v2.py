import streamlit as st
import pandas as pd

st.set_page_config(page_title="NOTAS SSAA", page_icon="ðŸ’ª", layout="wide")

# ===================== CSS =====================
st.markdown("""
<style>
div[data-testid="stNumberInput"] input,
div[data-testid="stTextInput"] input {
    width: 70px !important;
    text-align:center !important;
    padding: 4px !important;
    font-size: 0.95rem !important;
}
.block-container { padding-top: 0.8rem; padding-bottom: 0.8rem; }
</style>
""", unsafe_allow_html=True)

# ===================== BAREMOS COMPLETOS =====================
# (Los mismos que tÃº proporcionaste originalmente, completos)
baremos = {
    "PITO": {
        "Salto": {
            71: 10, 70: 9.7, 69: 9.4, 68: 9.1, 67: 8.9, 66: 8.7, 65: 8.4, 64: 8.2, 63: 8.0,
            62: 7.8, 61: 7.6, 60: 7.4, 59: 7.2, 58: 7.0, 57: 6.8, 56: 6.6, 55: 6.4, 54: 6.2,
            53: 6.0, 52: 5.8, 51: 5.6, 50: 5.4, 49: 5.2, 48: 5.0
        },

        "Flexiones": {
            70: 10, 69: 9.8, 68: 9.6, 67: 9.4, 66: 9.2, 65: 9.1, 64: 9.0, 63: 8.9, 62: 8.8,
            61: 8.7, 60: 8.6, 59: 8.5, 58: 8.4, 57: 8.3, 56: 8.2, 55: 8.1, 54: 8.0, 53: 7.9,
            52: 7.8, 51: 7.7, 50: 7.6, 49: 7.5, 48: 7.4, 47: 7.3, 46: 7.2, 45: 7.1, 44: 7.0,
            43: 6.9, 42: 6.8, 41: 6.7, 40: 6.6, 39: 6.5, 38: 6.4, 37: 6.3, 36: 6.2, 35: 6.1,
            34: 6.0, 33: 5.9, 32: 5.8, 31: 5.7, 30: 5.6, 29: 5.5, 28: 5.4, 27: 5.3, 26: 5.2,
            25: 5.1, 24: 5.0
        },

        "Velocidad": {
            6.3: 10, 6.4: 9.6, 6.5: 9.2, 6.6: 8.8, 6.7: 8.4, 6.8: 8.0, 6.9: 7.6, 7.0: 7.2,
            7.1: 6.8, 7.2: 6.5, 7.3: 6.2, 7.4: 5.9, 7.5: 5.6, 7.6: 5.3, 7.7: 5.0
        },

        "1000m":  {
             2.8333: 10.0, 2.8500: 9.9, 2.8667: 9.8, 2.8833: 9.7, 2.9000: 9.6, 2.9167: 9.5, 2.9333: 9.4,
             2.9500: 9.3, 2.9667: 9.2, 2.9833: 9.1, 3.0000: 9.0, 3.0167: 8.9, 3.0333: 8.8, 3.0500: 8.7,
             3.0667: 8.6, 3.0833: 8.5, 3.1000: 8.4, 3.1167: 8.3, 3.1333: 8.2, 3.1500: 8.1, 
             3.1667: 8.0, 3.1833: 7.9, 3.2000: 7.8, 3.2167: 7.7, 3.2333: 7.6, 3.2500: 7.5, 
             3.2667: 7.4, 3.2833: 7.3, 3.3000: 7.2, 3.3167: 7.1, 3.3333: 7.0, 3.3500: 6.9, 
             3.3667: 6.8, 3.3833: 6.7, 3.4000: 6.6, 3.4167: 6.5, 3.4333: 6.4, 3.4500: 6.3, 
             3.4667: 6.2, 3.4833: 6.1, 3.5000: 6.0, 3.5167: 5.9, 3.5333: 5.8, 3.5500: 5.7,  
             3.5667: 5.6, 3.5833: 5.5, 3.6000: 5.4, 3.6167: 5.3, 3.6333: 5.2, 3.6500: 5.1,
            3.6667: 5.0
        },

        "NataciÃ³n": {
            28: 10, 29: 9.8, 30: 9.6, 31: 9.4, 32: 9.2, 33: 9.0, 34: 8.8, 35: 8.6, 36: 8.4,
            37: 8.2, 38: 8.0, 39: 7.8, 40: 7.6, 41: 7.4, 42: 7.2, 43: 7.0, 44: 6.8, 45: 6.6,
            46: 6.4, 47: 6.2, 48: 6.0, 49: 5.8, 50: 5.6, 51: 5.5, 52: 5.4, 53: 5.3, 54: 5.2,
            55: 5.1, 56: 5.0
        },

        "6000m": {
         21.0000: 10.00, 21.1667: 9.80, 21.3333: 9.60, 21.5000: 9.40, 21.6667: 9.20, 21.8333: 9.00,
         22.0000: 8.85, 22.1667: 8.70, 22.3333: 8.55, 22.5000: 8.40, 22.6667: 8.25, 22.8333: 8.10,
         23.0000: 7.95, 23.1667: 7.85, 23.3333: 7.75, 23.5000: 7.65, 23.6667: 7.55, 23.8333: 7.45,
         24.0000: 7.35, 24.1667: 7.25, 24.3333: 7.15, 24.5000: 7.05, 24.6667: 6.95, 24.8333: 6.90,  
         25.0000: 6.85, 25.1667: 6.80, 25.3333: 6.75, 25.5000: 6.70, 25.6667: 6.65, 25.8333: 6.60,
         26.0000: 6.55, 26.1667: 6.50, 26.3333: 6.45, 26.5000: 6.40, 26.6667: 6.35, 26.8333: 6.30,
         27.0000: 6.25, 27.1667: 6.20, 27.3333: 6.15, 27.5000: 6.10, 27.6667: 6.05, 27.8333: 6.00,
         28.0000: 5.95, 28.1667: 5.90, 28.3333: 5.85, 28.5000: 5.80, 28.6667: 5.75, 28.8333: 5.70,
         29.0000: 5.65, 29.1667: 5.60, 29.3333: 5.55, 29.5000: 5.50, 29.6667: 5.45, 29.8333: 5.40,
         30.0000: 5.35, 30.1667: 5.30, 30.3333: 5.25, 30.5000: 5.20, 30.6667: 5.20, 30.8333: 5.15,
         31.0000: 5.15, 31.1667: 5.10, 31.3333: 5.10, 31.5000: 5.05, 31.6667: 5.05, 31.8333: 5.00,
         32.0000: 5.00
        }
    },

    "PITA": {
        "Salto": {56: 10, 55: 9.6, 54: 9.2, 53: 8.8, 52: 8.4, 51: 8.0, 50: 7.6, 49: 7.2, 48: 6.8,
                  47: 6.5, 46: 6.2, 45: 5.9, 44: 5.6, 43: 5.3, 42: 5.0},

        "Flexiones": {45: 10, 44: 9.8, 43: 9.6, 42: 9.4, 41: 9.2, 40: 9.0, 39: 8.8, 38: 8.6,
                      37: 8.4, 36: 8.2, 35: 8.0, 34: 7.8, 33: 7.6, 32: 7.4, 31: 7.2, 30: 7.0,
                      29: 6.8, 28: 6.6, 27: 6.4, 26: 6.2, 25: 6.0, 24: 5.8, 23: 5.6, 22: 5.4,
                      21: 5.3, 20: 5.2, 19: 5.1, 18: 5.0},

        "Velocidad": {7.2: 10, 7.3: 9.6, 7.4: 9.2, 7.5: 8.8, 7.6: 8.4, 7.7: 8.0,
                      7.8: 7.6, 7.9: 7.2, 8.0: 6.8, 8.1: 6.4, 8.2: 6.0, 8.3: 5.6,
                      8.4: 5.3, 8.5: 5.0},

        "1000m": {
            3.3333: 10.0, 3.3500: 9.9, 3.3667: 9.8, 3.3833: 9.7, 3.4000: 9.6, 3.4167: 9.5,
            3.4333: 9.4, 3.4500: 9.3, 3.4667: 9.2, 3.4833: 9.1, 3.5000: 9.0, 3.5167: 8.9,
            3.5333: 8.8, 3.5500: 8.7, 3.5667: 8.6, 3.5833: 8.5, 3.6000: 8.4, 3.6167: 8.3,
            3.6333: 8.2, 3.6500: 8.1, 3.6667: 8.0, 3.6833: 7.9, 3.7000: 7.8, 3.7167: 7.7,
            3.7333: 7.6, 3.7500: 7.5, 3.7667: 7.4, 3.7833: 7.3, 3.8000: 7.2, 3.8167: 7.1,
            3.8333: 7.0, 3.8500: 6.9, 3.8667: 6.8, 3.8833: 6.7, 3.9000: 6.6, 3.9167: 6.5,
            3.9333: 6.4, 3.9500: 6.3, 3.9667: 6.2, 3.9833: 6.1, 4.0000: 6.0, 4.0167: 5.9,
            4.0333: 5.8, 4.0500: 5.7, 4.0667: 5.6, 4.0833: 5.5, 4.1000: 5.4, 4.1167: 5.3,
            4.1333: 5.2, 4.1500: 5.1, 4.1667: 5.0
        },

        "NataciÃ³n": {33: 10, 34: 9.8, 35: 9.6, 36: 9.4, 37: 9.2, 38: 9.0, 39: 8.8, 40: 8.6,
                     41: 8.4, 42: 8.2, 43: 8.0, 44: 7.8, 45: 7.6, 46: 7.4, 47: 7.2, 48: 7.0,
                     49: 6.8, 50: 6.6, 51: 6.4, 52: 6.2, 53: 6.1, 54: 6.0, 55: 5.9, 56: 5.8,
                     57: 5.7, 58: 5.6, 59: 5.5, 60: 5.4, 61: 5.3, 62: 5.2, 63: 5.1, 64: 5.0},

        "6000m":  {
            24.0000: 10.00, 24.1667: 9.80, 24.3333: 9.60, 24.5000: 9.40, 24.6667: 9.20,
            24.8333: 9.00, 25.0000: 8.85, 25.1667: 8.70, 25.3333: 8.55, 25.5000: 8.40,
            25.6667: 8.25, 25.8333: 8.10, 26.0000: 7.95, 26.1667: 7.85, 26.3333: 7.75,
            26.5000: 7.65, 26.6667: 7.55, 26.8333: 7.45, 27.0000: 7.35, 27.1667: 7.25,
            27.3333: 7.15, 27.5000: 7.05, 27.6667: 6.95, 27.8333: 6.90, 28.0000: 6.85,
            28.1667: 6.80, 28.3333: 6.75, 28.5000: 6.70, 28.6667: 6.65, 28.8333: 6.60,
            29.0000: 6.55, 29.1667: 6.50, 29.3333: 6.45, 29.5000: 6.40, 29.6667: 6.35,
            29.8333: 6.30, 30.0000: 6.25, 30.1667: 6.20, 30.3333: 6.15, 30.5000: 6.10,
            30.6667: 6.05, 30.8333: 6.00, 31.0000: 5.95, 31.1667: 5.90, 31.3333: 5.85,
            31.5000: 5.80, 31.6667: 5.75, 31.8333: 5.70, 32.0000: 5.65, 32.1667: 5.60,
            32.3333: 5.55, 32.5000: 5.50, 32.6667: 5.45, 32.8333: 5.40, 33.0000: 5.35,
            33.1667: 5.30, 33.3333: 5.30, 33.5000: 5.25, 33.6667: 5.25, 33.8333: 5.20,
            34.0000: 5.20, 34.1667: 5.15, 34.3333: 5.15, 34.5000: 5.10, 34.6667: 5.10,
            34.8333: 5.10, 35.0000: 5.05, 35.1667: 5.05, 35.3333: 5.05, 35.5000: 5.00,
            35.6667: 5.00, 35.8333: 5.00, 36.0000: 5.00
        }
    }
}

# ===================== FUNCIONES =====================
def buscar_nota(valor, tabla, invertido=False):
    items = sorted([(float(k), float(v)) for k, v in tabla.items()],
                   key=lambda x: x[0], reverse=not invertido)

    for k, v in items:
        if (not invertido and valor >= k) or (invertido and valor <= k):
            return v

    raise ValueError(f"Valor fuera del baremo permitido: {valor}")

def tiempo_a_minutos(t):
    try:
        m, s = t.split(":")
        return float(m) + float(s)/60
    except:
        raise ValueError(f"Formato de tiempo incorrecto: {t} (usa mm:ss)")

def calcular_notas(sexo, salto, flexiones, velocidad, mil, natacion, seis):
    tabla = baremos[sexo]

    mil_t = tiempo_a_minutos(mil)
    seis_t = tiempo_a_minutos(seis)

    notas = {
        "Salto": buscar_nota(salto, tabla["Salto"]),
        "Flexiones": buscar_nota(flexiones, tabla["Flexiones"]),
        "Velocidad": buscar_nota(velocidad, tabla["Velocidad"], invertido=True),
        "1000m": buscar_nota(mil_t, tabla["1000m"], invertido=True),
        "NataciÃ³n": buscar_nota(natacion, tabla["NataciÃ³n"], invertido=True),
        "6000m": buscar_nota(seis_t, tabla["6000m"], invertido=True)
    }

    media = sum(notas.values()) / len(notas)
    nota_final = media * 0.9
    return notas, media, nota_final

# ===================== UI =====================
st.title("ðŸ“Š PRUEBAS FÃSICAS SSAA")
st.markdown("---")

sexo = st.radio("SEXO:", ["PITO", "PITA"])

st.subheader("ðŸ“ Introduce tus resultados")
c1, c2, c3 = st.columns(3)

with c1:
    salto = st.number_input("Salto vertical (cm)", min_value=0.0)
    flexiones = st.number_input("Flexiones vÃ¡lidas", min_value=0)

with c2:
    velocidad = st.number_input("Tiempo 50m (seg)", min_value=0.0, step=0.1)
    natacion = st.number_input("NataciÃ³n 50m (seg)", min_value=0.0, step=0.1)

with c3:
    mil = st.text_input("Tiempo 1000m (min:seg)", "0:00")
    seis = st.text_input("Tiempo 6000m (min:seg)", "0:00")

# ==== CALCULAR ====
try:
    notas, media, nota_final = calcular_notas(sexo, salto, flexiones, velocidad, mil, natacion, seis)
except ValueError as e:
    st.error(str(e))
    st.stop()

st.markdown("---")
st.subheader("ðŸ“ˆ Resultados")

df = pd.DataFrame(list(notas.items()), columns=["Prueba", "Nota"])

# OCULTAR COLUMNA IZQUIERDA 0 1 2 3
st.dataframe(df.style.hide(axis="index"), use_container_width=True)

st.markdown(f"**Media de pruebas:** {media:.2f}")
st.markdown(f"**Nota Final (Ã—0.9):** ðŸŸ© {nota_final:.2f}")

if st.button("ðŸ“¤ Exportar a Excel"):
    df.to_excel("resultados_fisicas.xlsx", index=False)
    st.success("Archivo 'resultados_fisicas.xlsx' guardado correctamente âœ…")

